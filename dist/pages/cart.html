<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>我的购物车-小米商城</title><link rel=stylesheet href=../sass/cart.css><link rel=stylesheet href=../css/reset.css><link rel=icon href=https://www.mi.com/favicon.ico><link rel=stylesheet href=../lib/bootstrap/dist/css/bootstrap.min.css></head><body><div class=wrap_header><div class=cart_header><div class=header_left><img src=../images/milogo.png alt=""><h3>我的购物车</h3><p>温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</p></div><div class=header_right><p>登录</p><p>注册</p></div></div></div><div class=wrap_cart><div class=goods_cart><div class=goods_header><ul><li><input type=checkbox>全选</li><li>商品名称</li><li>单价</li><li>数量</li><li>小计</li><li>操作</li></ul></div><div class=goods_list></div><div class=goods_jiesuan><div class=goods_num><a href="">继续购物</a><p>共 <span>1</span> 件商品，已选择 <span>1</span> 件</p></div><div class=price><p>共计<span>229元</span></p></div><div class=clearing><p>去结算</p></div></div></div></div><script src=../lib/jquery/dist/jquery.min.js></script><script>$.ajax({
            url:'/cartgoods',
            dataType:'json',
            success:function(res){
                // console.log(res)
                let str = ''
                res.forEach(element => {
                    str += `
                    <div class="goods_details">
                    <input type="checkbox">
                    <img src="${element.goodsimg}" alt="">
                    <h4>${element.goodsname}</h4>
                    <p>${element.goodsprice}</p>
                    <div class="goods_mun">
                        <a href="#" class= 'delnum' 
                        times='${element.times} '>-</a>
                        <p>${element.goodsnum}</p>
                        <a href="#" class= 'addnum' 
                        times='${element.times} '>+</a>
                    </div>
                    <h6>229</h6>
                    <span class="glyphicon glyphicon-remove del"></span>
                    </div>
                    `
                });
                $('.goods_list').html(str)
                //减少商品数量
                $('.delnum').click(function(){
                    let num = $('.goods_mun:first p').text()
                    num = num - 1
                    if($(num) == 1 ){
                        console.log('不能再删了')
                    }else{
                        $.ajax({
                            url: '/delnum',
                            method: 'post',
                            data:{
                                goodsnum:num,
                                times:$('.goods_mun:first').attr('class')
                            },
                            success:function(res){
                                $.ajax({
                                    url:'/cartgoods',
                                    dataType:'json',
                                    success:function(res){
                                        // console.log(res)

                                    }
                                
                                })
                            }
                        })

                    }
                })
                let num = $('.goods_mun:first p').text()
                //添加商品数量
                $('.addnum').click(function(){
                     num = num - 0 + 1
                     console.log(num)
                     console.log($(this).attr('times'))
                        $.ajax({
                            url: '/addnum',
                            method: 'post',
                            data:{
                                goodsnum:num,
                                times:$('.addnum').attr('times')
                            },
                            success:function(res){
                                $.ajax({
                                    url:'/cartgoods',
                                    dataType:'json',
                                    success:function(res){
                                        console.log(res)
                                        let goods = res.filter(function(item){
                                            console.log(item)
                                            return item.times == $('.addnum').attr('times')
                                        })
                                        // res.forEach(element => {
                                        // });
                                        console.log(goods)
                                        console.log($('.addnum').attr('times'))
                                        // $('.goods_mun:first p').text(goods)
                                    }
                                
                                })
                            }
                        })
                })
            }
        })</script></body></html>